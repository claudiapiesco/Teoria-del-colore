<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mixer HSL (tono-luminosità-saturazione) + Mix</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; line-height: 1.35; }
    h1 { font-size: 20px; margin: 0 0 12px; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 18px; max-width: 980px; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 14px; }
    .row { display: grid; grid-template-columns: 120px 1fr 70px; gap: 10px; align-items: center; margin: 8px 0; }
    .rowSmall { display: grid; grid-template-columns: 220px 1fr 90px; gap: 10px; align-items: center; margin: 8px 0; }
    .swatches { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-top: 10px; }
    .swatch { border: 1px solid #ddd; border-radius: 12px; padding: 10px; }
    .chip { height: 80px; border-radius: 10px; border: 1px solid rgba(0,0,0,.15); }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 13px; }
    .small { font-size: 12px; color: #444; }
    input[type="range"] { width: 100%; }
    .pill { display: inline-block; padding: 3px 8px; border-radius: 999px; border: 1px solid #ddd; }
    .kpi { margin-top: 6px; display:flex; flex-wrap:wrap; gap:10px; }
    .kpi span { border: 1px solid #eee; padding: 4px 8px; border-radius: 999px; }
    .footer { max-width: 980px; margin-top: 14px; color: #333; font-size: 13px; }
  </style>
</head>
<body>
  <h1>Mixer HSL (tono–saturazione–luminosità) con mix pesato</h1>

  <div class="grid">
    <div class="card">
      <div class="pill"><b>Colore 1 (HSL)</b></div>
      <div class="row"><label for="h1">Tono H (0–360)</label><input id="h1" type="range" min="0" max="360" value="0"><span id="h1v" class="mono">0</span></div>
      <div class="row"><label for="s1">Saturazione S (0–100)</label><input id="s1" type="range" min="0" max="100" value="100"><span id="s1v" class="mono">100</span></div>
      <div class="row"><label for="l1">Luminosità L (0–100)</label><input id="l1" type="range" min="0" max="100" value="50"><span id="l1v" class="mono">50</span></div>
      <div class="kpi">
        <span><b>RGB1</b> <span class="mono" id="rgb1">—</span></span>
        <span><b>Y1</b> <span class="mono" id="Y1">—</span></span>
      </div>
      <div class="small">Conversione HSL→RGB per visualizzare. Y è luminanza relativa sRGB (0–100).</div>
    </div>

    <div class="card">
      <div class="pill"><b>Colore 2 (HSL)</b></div>
      <div class="row"><label for="h2">Tono H (0–360)</label><input id="h2" type="range" min="0" max="360" value="120"><span id="h2v" class="mono">120</span></div>
      <div class="row"><label for="s2">Saturazione S (0–100)</label><input id="s2" type="range" min="0" max="100" value="100"><span id="s2v" class="mono">100</span></div>
      <div class="row"><label for="l2">Luminosità L (0–100)</label><input id="l2" type="range" min="0" max="100" value="50"><span id="l2v" class="mono">50</span></div>
      <div class="kpi">
        <span><b>RGB2</b> <span class="mono" id="rgb2">—</span></span>
        <span><b>Y2</b> <span class="mono" id="Y2">—</span></span>
      </div>
      <div class="small">HSL è comodo per “tono/saturazione/luminosità”, ma non è uno spazio fisico dei pigmenti.</div>
    </div>
  </div>

  <div class="card" style="max-width:980px; margin-top:18px;">
    <div class="pill"><b>Mix</b></div>
    <div class="rowSmall">
      <label for="a">a (quota del colore 1)</label>
      <input id="a" type="range" min="0" max="1" step="0.01" value="0.50">
      <span id="av" class="mono">0.50</span>
    </div>
    <div class="small">
      Il mix viene fatto in <b>luce lineare RGB</b> (più sensato su schermo): <span class="mono">LinMix = a·Lin1 + (1−a)·Lin2</span>.
      <br/>Nota: mescolare direttamente H (tono) è ambiguo perché è circolare (0°≡360°).
    </div>

    <div class="swatches">
      <div class="swatch">
        <div class="chip" id="chip1"></div>
        <div class="mono" id="c1txt" style="margin-top:8px;"></div>
      </div>
      <div class="swatch">
        <div class="chip" id="chip2"></div>
        <div class="mono" id="c2txt" style="margin-top:8px;"></div>
      </div>
      <div class="swatch">
        <div class="chip" id="chipm"></div>
        <div class="mono" id="cmtxt" style="margin-top:8px;"></div>
        <div class="kpi">
          <span><b>Ymix</b> <span class="mono" id="Ym">—</span></span>
        </div>
      </div>
    </div>
  </div>

  <div class="footer">
    <b>Uso in classe:</b> gli studenti impostano due colori in HSL e osservano come cambiano RGB e luminanza; poi regolano <span class="mono">a</span> per ottenere un mix con luminanza desiderata (o per confrontare con “grigio armonico”).
  </div>

<script>
  const ids = ["h1","s1","l1","h2","s2","l2","a"];
  const el = Object.fromEntries(ids.map(id => [id, document.getElementById(id)]));

  const setText = (id, v) => document.getElementById(id).textContent = v;

  function clamp01(x){ return Math.max(0, Math.min(1, x)); }

  // sRGB transfer functions
  function srgbToLinear(u){
    return (u <= 0.04045) ? (u/12.92) : Math.pow((u + 0.055)/1.055, 2.4);
  }
  function linearToSrgb(u){
    return (u <= 0.0031308) ? (12.92*u) : (1.055*Math.pow(u, 1/2.4) - 0.055);
  }

  // HSL (0..360, 0..100, 0..100) -> sRGB (0..1)
  function hslToRgb01(h, s, l){
    h = ((h % 360) + 360) % 360;
    s = clamp01(s/100);
    l = clamp01(l/100);

    const c = (1 - Math.abs(2*l - 1)) * s;
    const hp = h / 60;
    const x = c * (1 - Math.abs((hp % 2) - 1));
    let r1=0,g1=0,b1=0;

    if (0 <= hp && hp < 1) { r1=c; g1=x; b1=0; }
    else if (1 <= hp && hp < 2) { r1=x; g1=c; b1=0; }
    else if (2 <= hp && hp < 3) { r1=0; g1=c; b1=x; }
    else if (3 <= hp && hp < 4) { r1=0; g1=x; b1=c; }
    else if (4 <= hp && hp < 5) { r1=x; g1=0; b1=c; }
    else { r1=c; g1=0; b1=x; }

    const m = l - c/2;
    return [r1+m, g1+m, b1+m];
  }

  function rgb01ToCss(rgb){
    const r = Math.round(clamp01(rgb[0])*255);
    const g = Math.round(clamp01(rgb[1])*255);
    const b = Math.round(clamp01(rgb[2])*255);
    return `rgb(${r}, ${g}, ${b})`;
  }

  function rgb01To255(rgb){
    return [
      Math.round(clamp01(rgb[0])*255),
      Math.round(clamp01(rgb[1])*255),
      Math.round(clamp01(rgb[2])*255)
    ];
  }

  function luminanceFromRgb01(rgb){
    // compute relative luminance from linear RGB
    const R = srgbToLinear(clamp01(rgb[0]));
    const G = srgbToLinear(clamp01(rgb[1]));
    const B = srgbToLinear(clamp01(rgb[2]));
    const Y = 0.2126*R + 0.7152*G + 0.0722*B;
    return Y; // 0..1
  }

  function mixLinearRgb01(rgbA, rgbB, a){
    const Ra = srgbToLinear(clamp01(rgbA[0])), Ga = srgbToLinear(clamp01(rgbA[1])), Ba = srgbToLinear(clamp01(rgbA[2]));
    const Rb = srgbToLinear(clamp01(rgbB[0])), Gb = srgbToLinear(clamp01(rgbB[1])), Bb = srgbToLinear(clamp01(rgbB[2]));
    const Rm = a*Ra + (1-a)*Rb;
    const Gm = a*Ga + (1-a)*Gb;
    const Bm = a*Ba + (1-a)*Bb;
    return [linearToSrgb(Rm), linearToSrgb(Gm), linearToSrgb(Bm)];
  }

  function update(){
    const h1 = +el.h1.value, s1 = +el.s1.value, l1 = +el.l1.value;
    const h2 = +el.h2.value, s2 = +el.s2.value, l2 = +el.l2.value;
    const a  = +el.a.value;

    setText("h1v", h1); setText("s1v", s1); setText("l1v", l1);
    setText("h2v", h2); setText("s2v", s2); setText("l2v", l2);
    setText("av", a.toFixed(2));

    const rgb1 = hslToRgb01(h1,s1,l1);
    const rgb2 = hslToRgb01(h2,s2,l2);

    document.getElementById("chip1").style.background = rgb01ToCss(rgb1);
    document.getElementById("chip2").style.background = rgb01ToCss(rgb2);

    const [R1,G1,B1] = rgb01To255(rgb1);
    const [R2,G2,B2] = rgb01To255(rgb2);

    setText("rgb1", `(${R1}, ${G1}, ${B1})`);
    setText("rgb2", `(${R2}, ${G2}, ${B2})`);

    const Y1 = luminanceFromRgb01(rgb1)*100;
    const Y2 = luminanceFromRgb01(rgb2)*100;
    setText("Y1", Y1.toFixed(1));
    setText("Y2", Y2.toFixed(1));

    setText("c1txt", `HSL1 = (${h1}°, ${s1}%, ${l1}%)`);
    setText("c2txt", `HSL2 = (${h2}°, ${s2}%, ${l2}%)`);

    // Mix (linear RGB), then show
    const rgbm = mixLinearRgb01(rgb1, rgb2, a);
    document.getElementById("chipm").style.background = rgb01ToCss(rgbm);

    const [Rm,Gm,Bm] = rgb01To255(rgbm);
    const Ym = luminanceFromRgb01(rgbm)*100;

    setText("cmtxt", `Mix RGB = (${Rm}, ${Gm}, ${Bm})`);
    setText("Ym", Ym.toFixed(1));
  }

  ids.forEach(id => el[id].addEventListener("input", update));
  update();
</script>
</body>
</html>
